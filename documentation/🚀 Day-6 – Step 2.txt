ğŸš€ Day-6 â€“ Step 2
Publish First OrderCreatedEvent (Without Outbox Yet)

âš ï¸ Important:
In this step we are NOT implementing Outbox yet.
We first prove basic event publishing works.

ğŸ¯ Goal of Step-2

âœ” When Order is created â†’ Event published to Kafka
âœ” Payment Service consumes event
âœ” Payment logic triggered
âœ” Order still works

We are validating async communication first.

ğŸ§± Step 2.1 â€“ Create Event Class (Order Service)

Create:

com.foodroute.order.service.event
OrderCreatedEvent.java
public record OrderCreatedEvent(
        String orderId,
        String userId,
        String restaurantId,
        BigDecimal amount
) {}
ğŸ§± Step 2.2 â€“ Inject KafkaTemplate in Order Service

Modify OrderServiceImpl

Add:

private final KafkaTemplate<String, Object> kafkaTemplate;

Update constructor:

public OrderServiceImpl(OrderRepository orderRepository,
                        KafkaTemplate<String, Object> kafkaTemplate) {
    this.orderRepository = orderRepository;
    this.kafkaTemplate = kafkaTemplate;
}
ğŸ§± Step 2.3 â€“ Publish Event After Order Save

Inside createOrder()
After saving order:

OrderCreatedEvent event = new OrderCreatedEvent(
        order.getOrderId(),
        order.getUserId(),
        order.getRestaurantId(),
        order.getTotalAmount()
);

kafkaTemplate.send("order-events", order.getOrderId(), event);

Now flow becomes:

Order saved
â†’ Publish OrderCreatedEvent
ğŸ§ª Step 2.4 â€“ Test Publishing

1ï¸âƒ£ Start Kafka
2ï¸âƒ£ Start Order Service
3ï¸âƒ£ Create order via Gateway

Now check logs.
You should see something like:

Sending record to topic order-events
ğŸš¦ STOP â€“ Do NOT implement Payment listener yet

First confirm event is being published.

ğŸ” Optional: Verify Topic Exists

Run inside container:

docker exec -it <kafka-container-id> kafka-topics --list --bootstrap-server localhost:9092
or
docker exec -it kafka /bin/sh
# kafka-topics.sh --list --bootstrap-server localhost:9092

You should see:

order-events
âœ… Step-2 Completion Checklist

âœ” Order API works
âœ” Event published
âœ” No Kafka errors
âœ” order-events topic created